---
title: "Data Layers"
output: rmarkdown::html_vignette
resource_files:
  - images/layersOff.png
  - "datalayers.html" # generated by code block at the end of vignette and displayed in an iframe
vignette: >
  %\VignetteIndexEntry{Continuous Color Maps and Data Layers}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

In addition to specifying color maps (see [Color Maps](color-maps.html)), data layers allow
for displaying multiple data sets in the same NG-CHM. This vignette
describes how to create an NG-CHM with multiple data layers.

These examples build on the setup from [Getting Started](getting-started.html)

## Data Layers

The function `chmNewDataLayer()` creates a data layer. The first argument is the desired name of the data layer,
the second argument is the matrix of data, and the third argument is the color map.
The example below creates a color map and a data layer for the TCGA BRCA Expression data.
See [Color Maps](color-maps.html) for more information on creating color maps.

```{r, eval=FALSE}
dataColorMap <- chmNewColorMap(c(6.4, 10, 14), c("mediumblue", "snow", "firebrick"))
dataLayer <- chmNewDataLayer("Unadjusted", matrix_data, dataColorMap)
```

For a second data layer, the data is row centered. The code block below
row-centers the data, creates a color map, and creates a second data layer for the row-centered data.

```{r, eval=FALSE}
rowCenteredData <- t(scale(t(matrix_data)))
rowCenteredColorMap <- chmNewColorMap(c(-2, 0, 2), c("#9933ff", "#f0f0f0", "#228B22"))
rowCenteredLayer <- chmNewDataLayer("Row-Centered", rowCenteredData, rowCenteredColorMap)
```

The NG-CHM can then be created with both data layers:

```{r, eval=FALSE}
hm <- chmNew("TCGA BRCA Expression", dataLayer, rowCenteredLayer)
```

[Back to top](#)

## Resulting NG-CHM

Below is the full code block and resulting NG-CHM.

```{r, eval=FALSE}
library(NGCHMDemoData)
library(NGCHMSupportFiles)
library(NGCHM)
matrix_data_file <- system.file("extdata", "TCGA.BRCA.Expression.csv", package = "NGCHMDemoData")
matrix_data <- as.matrix(read.csv(matrix_data_file, header = TRUE, row.names = 1, check.names = FALSE))
covariate_data_file <- system.file("extdata", "TCGA.BRCA.TP53Mutation.csv", package = "NGCHMDemoData")
covariate_data <- as.matrix(read.csv(covariate_data_file, row.names = 1))
covariate_vector <- as.vector(covariate_data) # create vector of mutation data
names(covariate_vector) <- rownames(covariate_data) # set the names
dataColorMap <- chmNewColorMap(c(6.4, 10, 14), c("mediumblue", "snow", "firebrick"))
dataLayer <- chmNewDataLayer("Unadjusted", matrix_data, dataColorMap)
rowCenteredData <- t(scale(t(matrix_data)))
rowCenteredColorMap <- chmNewColorMap(c(-2, 0, 2), c("#9933ff", "#f0f0f0", "#228B22"))
rowCenteredLayer <- chmNewDataLayer("Row-Centered", rowCenteredData, rowCenteredColorMap)
hm <- chmNew("TCGA BRCA Expression", dataLayer, rowCenteredLayer)
chmExportToHTML(hm, "datalayers.html", overwrite = TRUE)
htmltools::tags$iframe(src = "datalayers.html", width = "100%", height = 700)
```


<!-- svg symbol symbol taken from NG-CHM viewer:
     https://github.com/MD-Anderson-Bioinformatics/NG-CHM/blob/main/NGCHM/WebContent/icons.svg?short_path=fffa0d9
-->

<svg style="display:none;">
  <symbol id="icon-layers" xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-layers" viewBox="0 0 16 16">
    <path d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zm3.515 7.008L14.438 10 8 13.433 1.562 10 4.25 8.567l3.515 1.874a.5.5 0 0 0 .47 0l3.515-1.874zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z"/>
  </symbol>
</svg>

The resulting NG-CHM has the two data layers available. To toggle between layers, click the
<button class="fromViewer">
  <svg style="width:16px;height:16px;vertical-align:middle;" viewBox="0 0 16 16">
    <use xlink:href="#icon-layers"></use>
  </svg>
</button>
icon (the first of the 4 buttons on the upper right side).

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(NGCHMDemoData)
library(NGCHMSupportFiles)
library(NGCHM)
matrix_data_file <- system.file("extdata", "TCGA.BRCA.Expression.csv", package = "NGCHMDemoData")
matrix_data <- as.matrix(read.csv(matrix_data_file, header = TRUE, row.names = 1, check.names = FALSE))
covariate_data_file <- system.file("extdata", "TCGA.BRCA.TP53Mutation.csv", package = "NGCHMDemoData")
covariate_data <- as.matrix(read.csv(covariate_data_file, row.names = 1))
covariate_vector <- as.vector(covariate_data) # create vector of mutation data
names(covariate_vector) <- rownames(covariate_data) # set the names
dataColorMap <- chmNewColorMap(c(6.4, 10, 14), c("mediumblue", "snow", "firebrick"))
dataLayer <- chmNewDataLayer("Unadjusted", matrix_data, dataColorMap)
rowCenteredData <- t(scale(t(matrix_data)))
rowCenteredColorMap <- chmNewColorMap(c(-2, 0, 2), c("#9933ff", "#f0f0f0", "#228B22"))
rowCenteredLayer <- chmNewDataLayer("Row-Centered", rowCenteredData, rowCenteredColorMap)
hm <- chmNew("TCGA BRCA Expression", dataLayer, rowCenteredLayer)
invisible(chmExportToHTML(hm, "datalayers.html", overwrite = TRUE))
htmltools::tags$iframe(src = "datalayers.html", width = "100%", height = 700)
```

[Back to top](#)
